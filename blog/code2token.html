<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>LOGING</title>

</head>

<body>
  <script>
    (function () {
      /**
       * data type
       */
      function dataType(data) {
        if (!data) return false

        return Object.prototype.toString.apply(data).slice(8, -1).toLowerCase()
      }

      /** 
       * query parse 
       */
      function queryParse() {
        if (arguments.length === 0) {
          return {}
        }

        var _match = []

        for (var i in arguments) {
          if (dataType(arguments[i]) === 'string') {
            var _item = arguments[i].match(/(\?|&)?[^\?&#\/]+=[^&#\/]+/g)

            if (_item) {
              _match = _match.concat(_item)
            }
          }
        }

        var _data = {}

        for (var i in _match) {
          var _item = _match[i].match(/(\?|&)?([^&#\/]+)=([^&#\/]+)/)

          if (_item) {
            _data[_item[2]] = _item[3]
          }
        }

        return _data
      }

      function queryStringify() {
        for (var _len = arguments.length, params = new Array(_len), _key = 0; _key < _len; _key++) {
          params[_key] = arguments[_key];
        }

        if (params.length === 0) return '';
        var _data = [];

        for (var i in params) {
          if (dataType(params[i]) === 'object') {
            for (var _key2 in params[i]) {
              if (params[i][_key2] || dataType(params[i][_key2]) === 'number') {
                _data.push(_key2 + '=' + params[i][_key2].toString());
              }
            }
          }
        }

        return _data.join('&');
      }

      /** 
       * ajax
       */
      function ajax(config) {
        var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
        var method = (config.method || 'GET').toUpperCase();

        if (method === 'GET') {
          var _prefix = /\?/.test(config.url) ? '&' : '?'
          config.url += (_prefix + queryStringify(config.data))
        }

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            xhr.status === 200 ? dataType(config.success) === 'function' && config.success(xhr
              .response) :
              dataType(config.error) === 'function' && config.error(xhr.response)
          }
        }
        xhr.open(method, config.url, true)

        xhr.setRequestHeader('Accept',
          'application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json');
        xhr.setRequestHeader('Content-Type', "application/json");

        if (dataType(config.headers) === 'object') {
          for (var key in config.headers) {
            xhr.setRequestHeader(key, config.headers[key])
          }
        }

        xhr.send(method === 'GET' ? null : JSON.stringify(config.data))
      }

      var query = queryParse(location.href)
      var redirectQuery = {}

      if (query.redirect) {
        redirectQuery = queryParse(decodeURIComponent(query.redirect))
      }

      if (!query.code || !query.redirect) {
        document.body.innerHTML = 'Lack of necessary parameters'
        return false
      }

      ajax({
        url: `https://github.com/login/oauth/access_token`,
        method: 'POST',
        data: {
          code: query.code,
          client_id: redirectQuery.client_id, 
          client_secret: redirectQuery.client_secret, 
          redirect_uri: redirectQuery.redirect
        },

        success: function (res) {
          document.body.innerHTML = '<a href='+redirectQuery.redirect+'>' +redirectQuery.redirect+ '</a>' 
        },

        error: function (error) {
          document.body.innerHTML = error
        }
      })
    })();
  </script>
</body>

</html>